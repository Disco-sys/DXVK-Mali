    - name: Build release
      id: build-release
      uses: Joshua-Ashton/arch-mingw-github-action@v8
      with:
        command: |
          # --- THE FINAL COMPREHENSIVE FIX ---
          # We inject all missing Mali-specific variables at once:
          # 1. wrc_generator: Handles resource files
          # 2. dll_ext & def_spec_ext: Handle file naming
          # 3. lib_dxgi: Defines the dependency link for D3D11
          
          VAR_FIXES="wrc_generator = generator(find_program('windres'), output: '@BASENAME@.res', arguments: [ '@INPUT@', '@OUTPUT@' ])\ndll_ext = '.dll'\ndef_spec_ext = '.def'\nlib_dxgi = declare_dependency(link_with: subproject('dxgi').get_variable('dxgi_dll'))"
          
          # If subprojects aren't used, we use a simpler link:
          # VAR_FIXES="wrc_generator = generator(find_program('windres'), output: '@BASENAME@.res', arguments: [ '@INPUT@', '@OUTPUT@' ])\ndll_ext = '.dll'\ndef_spec_ext = '.def'\nlib_dxgi = declare_dependency(link_args: ['-ldxgi'])"
          
          # Using the standard link_args version as it is safer for cross-compiling
          sed -i "2i wrc_generator = generator(find_program('windres'), output: '@BASENAME@.res', arguments: [ '@INPUT@', '@OUTPUT@' ])\ndll_ext = '.dll'\ndef_spec_ext = '.def'\nlib_dxgi = declare_dependency(link_args: ['-ldxgi'])" meson.build
          
          # Fix version header and script permissions
          mkdir -p ./src/dxvk && echo '#define DXVK_VERSION "1.11.0"' > ./src/dxvk/dxvk_version.h
          chmod +x package-release.sh

          # Set clean version and run build
          export VERSION_NAME="master"
          ./package-release.sh ${VERSION_NAME} build --no-package
          echo "VERSION_NAME=${VERSION_NAME}" >> $GITHUB_ENV
